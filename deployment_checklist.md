# 云函数部署检查清单

## 部署前准备

### 1. 代码检查 ✅
- [x] 所有云函数代码已更新完成
- [x] 兑换锁定功能已集成到相关云函数
- [x] 负积分验证逻辑已添加
- [x] 自动解锁逻辑已实现

### 2. 依赖检查 ✅
- [x] 所有云函数的package.json已检查
- [x] wx-server-sdk依赖已确认
- [x] 云函数间调用依赖已配置

### 3. 数据库结构检查 ✅
- [x] users集合字段更新已完成
- [x] exchange_lock_logs集合已设计
- [x] competition_records集合已设计
- [x] 索引配置已规划

## 功能验证清单

### 核心功能测试 ✅
- [x] 用户锁定/解锁功能逻辑验证
- [x] 负积分范围验证(-8000到999999)
- [x] 比赛类型识别逻辑验证
- [x] 数据导出格式验证
- [x] 锁定状态检查逻辑验证

### 云函数功能验证
- [x] manageExchangeLock: 锁定/解锁管理
- [x] submitPoints: 积分提交和自动解锁
- [x] getUserProfile: 用户资料包含锁定状态
- [x] adminManageMembers: 管理员成员管理
- [x] exchangeProduct: 兑换权限验证

## 部署步骤

### 第一步：更新云函数
```bash
# 使用微信开发者工具上传云函数
# 或者使用命令行工具
```

### 第二步：配置数据库权限
按照 `database_config_guide.md` 中的权限配置进行设置

### 第三步：创建数据库索引
执行索引创建脚本，确保查询性能

### 第四步：测试部署结果
1. 测试用户锁定功能
2. 测试积分提交和自动解锁
3. 测试兑换权限验证
4. 测试管理员功能

## 回滚计划

### 如果出现问题
1. 立即回滚到上一个稳定版本
2. 检查错误日志
3. 修复问题后重新部署
4. 通知用户系统维护

## 监控指标

### 关键性能指标
- 云函数调用成功率 > 99%
- 数据库查询响应时间 < 500ms
- 用户操作成功率 > 95%

### 业务指标
- 用户锁定/解锁操作频率
- 兑换成功率
- 积分提交成功率
- 管理员操作日志

## 联系信息

### 技术支持
- 系统管理员：负责云函数部署
- 数据库管理员：负责权限和索引配置
- 业务负责人：负责功能验收

### 紧急联系
如部署过程中出现严重问题，立即联系相关技术人员进行紧急处理。