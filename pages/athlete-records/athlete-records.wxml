<!--pages/athlete-records/athlete-records.wxml-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="header-bg">
      <view class="header-content">
        <view class="back-btn" bindtap="onBack">
          <text class="back-icon">â€¹</text>
        </view>
        <view class="header-info">
          <text class="header-title">{{userInfo.nickName}}</text>
          <text class="header-subtitle">Taçš„é“ä¸‰åŠ¨æ€</text>
        </view>
        <view class="share-btn" bindtap="onShareRecord">
          <text class="share-icon">â‹¯</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <text class="error-icon">âš </text>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="loadAthleteRecords">é‡è¯•</button>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="content">
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="stats-overview">
      <view class="stats-item">
        <text class="stats-number">{{totalRaces}}</text>
        <text class="stats-label">å®Œèµ›æ¬¡æ•°</text>
      </view>
      <view class="stats-divider"></view>
      <view class="stats-item">
        <text class="stats-number">{{totalPoints}}</text>
        <text class="stats-label">æ€»ç§¯åˆ†</text>
      </view>
    </view>

    <!-- å¹´ä»½é€‰æ‹©å™¨ -->
    <view class="year-selector" wx:if="{{availableYears.length > 1}}">
      <text class="year-label">å¹´ä»½ï¼š</text>
      <picker mode="selector" range="{{availableYears}}" value="{{availableYears.indexOf(selectedYear)}}" bindchange="onYearChange">
        <view class="year-picker">
          <text class="year-text">{{selectedYear}}</text>
          <text class="year-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <!-- å¹´åº¦ç»Ÿè®¡ -->
    <view class="yearly-stats" wx:if="{{yearlyStats[selectedYear]}}">
      <view class="yearly-header">
        <text class="yearly-title">{{selectedYear}}å¹´æˆ˜ç»©</text>
        <view class="yearly-summary">
          <text class="yearly-races">{{yearlyStats[selectedYear].totalRaces}}åœº</text>
          <text class="yearly-points">{{yearlyStats[selectedYear].totalPoints.toFixed(2)}}åˆ†</text>
        </view>
      </view>
    </view>

    <!-- æ¯”èµ›è®°å½•åˆ—è¡¨ -->
    <view class="records-list" wx:if="{{yearlyStats[selectedYear] && yearlyStats[selectedYear].races.length > 0}}">
      <view class="record-item" wx:for="{{yearlyStats[selectedYear].races}}" wx:key="id">
        <view class="record-header">
          <view class="record-info">
            <text class="record-name">{{item.name}}</text>
            <view class="record-meta">
              <text class="record-type">{{item.type}}</text>
              <text class="record-date">{{item.date}}</text>
            </view>
          </view>
          <view class="record-result">
            <text class="record-time">{{item.time}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{!yearlyStats[selectedYear] || yearlyStats[selectedYear].races.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸƒâ€â™‚ï¸</text>
      <text class="empty-text">{{selectedYear}}å¹´æš‚æ— æ¯”èµ›è®°å½•</text>
      <text class="empty-desc">æœŸå¾…æ›´å¤šç²¾å½©è¡¨ç°</text>
    </view>
  </view>
</view>