<!--æ¶ˆæ¯ä¸­å¿ƒé¡µé¢-->
<view class="container">
  <!-- ç´§å‡‘å‹é¡¶éƒ¨æ  -->
  <view class="header-bar">
    <view class="tabs">
      <view class="tab {{activeTab === 'all' ? 'active' : ''}}" data-tab="all" bindtap="onTabChange">
        å…¨éƒ¨ <text class="badge" wx:if="{{unreadCount.all}}">{{unreadCount.all}}</text>
      </view>
      <view class="tab {{activeTab === 'audit_result' ? 'active' : ''}}" data-tab="audit_result" bindtap="onTabChange">
        å®¡æ ¸ <text class="badge" wx:if="{{unreadCount.audit_result}}">{{unreadCount.audit_result}}</text>
      </view>
      <view class="tab {{activeTab === 'exchange_status' ? 'active' : ''}}" data-tab="exchange_status" bindtap="onTabChange">
        å…‘æ¢ <text class="badge" wx:if="{{unreadCount.exchange_status}}">{{unreadCount.exchange_status}}</text>
      </view>
      <view class="tab {{activeTab === 'system' ? 'active' : ''}}" data-tab="system" bindtap="onTabChange">
        ç³»ç»Ÿ <text class="badge" wx:if="{{unreadCount.system}}">{{unreadCount.system}}</text>
      </view>
    </view>
    <view class="mark-read-btn" bindtap="markAllAsRead" wx:if="{{unreadCount[activeTab] > 0}}">
      <text class="icon-check">âœ“</text> å·²è¯»
    </view>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view scroll-y class="message-scroll" enable-flex>
    <view class="message-list">
      <block wx:for="{{messages}}" wx:key="_id">
        <view class="msg-card {{!item.isRead ? 'unread' : ''}}" bindtap="onMessageTap" data-message="{{item}}">
          <view class="msg-main">
            <view class="msg-header">
              <view class="msg-title-wrap">
                <text class="msg-type-icon {{item.type}}">{{item.type === 'audit_result' ? 'ğŸ“‹' : (item.type === 'exchange_status' ? 'ğŸ' : 'ğŸ“¢')}}</text>
                <text class="msg-title">{{item.title}}</text>
              </view>
              <text class="msg-time">{{item.timeFormatted || item.createTime}}</text>
            </view>
            <view class="msg-content">{{item.content}}</view>
          </view>
          <view class="msg-action" catchtap="deleteMessage" data-message="{{item}}" wx:if="{{item.deletable}}">
            <text class="delete-icon">Ã—</text>
          </view>
        </view>
      </block>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{!loading && messages.length === 0}}">
        <text class="empty-text">æš‚æ— æ¶ˆæ¯</text>
      </view>
      
       <!-- åŠ è½½æ›´å¤š/æ— æ›´å¤š -->
      <view class="list-footer" wx:if="{{messages.length > 0}}">
         <text wx:if="{{loading}}">åŠ è½½ä¸­...</text>
         <text wx:elif="{{!hasMore}}" class="no-more">â€”â€” æ²¡æœ‰æ›´å¤šäº† â€”â€”</text>
      </view>
    </view>
  </scroll-view>
</view>
