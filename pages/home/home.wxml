<!--pages/home/home.wxml-->
<view class="container">
  <!-- Brand Header -->
  <view class="brand-header">
    <view class="brand-info">
      <text class="slogan">TEAM 7</text>
      <text class="sub-slogan">From zero to hero</text>
      <text class="motto">ä¸€ç¾¤äººï¼Œä¸€ä»¶äº‹ï¼Œä¸€7æ‹¼ï¼Œä¸€7èµ¢</text>
    </view>
  </view>

  <!-- User Info Card -->
  <view class="card user-info-card">
    <view class="user-section">
      <view class="user-details">
        <view class="user-text-info">
           <view class="user-name">{{isLoggedIn ? (userInfo.nickName || 'å¾®ä¿¡ç”¨æˆ·') : 'æœªç™»å½•'}}</view>
           <view class="user-status-wrapper">
             <text class="status-badge {{userInfo.isExchangeActivated ? 'activated' : 'inactive'}}">
               {{userInfo.isExchangeActivated ? 'å·²æ¿€æ´»' : 'æœªæ¿€æ´»'}}
             </text>
           </view>
        </view>
      </view>
      <view class="points-display">
        <text class="points-number">{{userInfo.totalPoints || 0}}</text>
        <text class="points-label">ç§¯åˆ†</text>
      </view>
    </view>
  </view>

  <!-- Menu Grid -->
  <view class="action-grid">
    <view class="action-item" bindtap="navigateToUpload">
      <image class="action-icon-img" src="/images/icon-upload.png" wx:if="{{false}}"></image>
      <view class="action-icon" wx:else>ğŸ“¤</view>
      <text class="action-text">ä¸Šä¼ æ‰“å¡</text>
    </view>
    <view class="action-item" bindtap="navigateToStore">
      <image class="action-icon-img" src="/images/icon-store.png" wx:if="{{false}}"></image>
      <view class="action-icon" wx:else>ğŸ›ï¸</view>
      <text class="action-text">ç§¯åˆ†å…‘æ¢</text>
    </view>
    <view class="action-item" bindtap="navigateToLeaderboard">
      <image class="action-icon-img" src="/images/icon-rank.png" wx:if="{{false}}"></image>
      <view class="action-icon" wx:else>ğŸ†</view>
      <text class="action-text">æ’è¡Œæ¦œ</text>
    </view>
    <view class="action-item" bindtap="navigateToTrainingAssistant">
      <view class="action-icon">ğŸ“Š</view>
      <text class="action-text">ç«è®­åŠ©æ‰‹</text>
    </view>
    <view class="action-item" bindtap="navigateToTools">
      <view class="action-icon">ğŸ› ï¸</view>
      <text class="action-text">é“äººåŠ©æ‰‹</text>
    </view>
    <view class="action-item" bindtap="navigateToProfile">
      <image class="action-icon-img" src="/images/icon-user.png" wx:if="{{false}}"></image>
      <view class="action-icon" wx:else>ğŸ‘¤</view>
      <text class="action-text">ä¸ªäººä¸­å¿ƒ</text>
    </view>
  </view>

  <!-- Announcements -->
  <view class="card announcements-card" wx:if="{{announcements.length > 0}}">
    <view class="announcement-header">
      <text class="ann-label">å…¬å‘Š</text>
    </view>
    <swiper class="announcements-swiper" autoplay="true" interval="5000" circular="true" indicator-dots="true" bindchange="onAnnSwiperChange">
      <block wx:for="{{announcements}}" wx:key="_id" wx:for-index="index">
        <swiper-item>
          <view class="announcement-item">
            <view class="ann-row-top">
              <text class="tag">é€šçŸ¥</text>
              <text class="ann-title">{{item.title}}</text>
            </view>
            <text class="ann-time">{{item.createTime}}</text>
            <scroll-view scroll-y="true" class="ann-content-scroll" scroll-top="{{annScrollTop}}">
              <text class="ann-content">{{item.content}}</text>
            </scroll-view>
          </view>
        </swiper-item>
      </block>
    </swiper>
  </view>

  <!-- Training Bulletins Carousel -->
  <view class="card bulletin-card" wx:if="{{bulletins.length > 0}}">
    <view class="bulletin-header">
      <text class="bulletin-title">è®­ç»ƒé€šå‘Š</text>
    </view>
    <swiper autoplay="true" interval="5000" circular="true" indicator-dots="true">
      <block wx:for="{{bulletins}}" wx:key="_id">
        <swiper-item>
          <view>
            <view class="bulletin-subheader">
              <text class="bulletin-time">{{item.time}}</text>
              <text class="bulletin-sep">Â·</text>
              <text class="bulletin-location">{{item.location}}</text>
            </view>
            <view class="bulletin-content">{{item.content}}</view>
            <view class="bulletin-actions">
              <view class="join-btn" data-id="{{item._id}}" bindtap="toggleJoinBulletin">{{joinedMap[item._id] ? 'å–æ¶ˆ' : 'æ¥é¾™'}}</view>
              <scroll-view class="participants-inline" scroll-x="true">
                <block wx:for="{{item.participants}}" wx:key="openid" wx:for-item="p">
                  <text class="participant-chip">{{p.nickName || 'å¾®ä¿¡ç”¨æˆ·'}}</text>
                </block>
              </scroll-view>
            </view>
          </view>
        </swiper-item>
      </block>
    </swiper>
  </view>

  <!-- Banner -->
  <view class="camp-section">
    <view class="camp-card" bindtap="onJoinCamp">
      <view class="camp-row">
        <text class="camp-icon">ğŸƒ</text>
        <text class="camp-title">IRONMAN 70.3 æ¨ªç´è®­ç»ƒè¥</text>
      </view>
      <text class="camp-subtitle">{{campStatus === 'approved' ? 'ç«‹å³åŠ å…¥' : 'ç”³è¯·å…¥è¥'}}</text>
    </view>
  </view>

  

  <!-- Partners Section -->
  <view class="partners-section">
    <view class="partners-header">
      <text class="partners-title">åˆä½œä¼™ä¼´</text>
    </view>
    <view class="partners-grid">
      <block wx:for="{{partners}}" wx:key="index">
        <view class="partner-item" bindtap="uploadPartnerImage" data-index="{{index}}">
          <image class="partner-img" src="{{item.url}}" mode="aspectFit" wx:if="{{item.url}}"></image>
          <view class="partner-placeholder" wx:else></view>
        </view>
      </block>
    </view>
  </view>
</view>
