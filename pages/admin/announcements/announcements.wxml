<view class="container">
  <!-- Subtabs Header -->
  <view class="tabs-header">
    <view class="tab-item {{subTab==='ann'?'active':''}}" data-key="ann" bindtap="switchSubTab">å…¬å‘Šç®¡ç†</view>
    <view class="tab-item {{subTab==='bulletin'?'active':''}}" data-key="bulletin" bindtap="switchSubTab">è®­ç»ƒé€šå‘Š</view>
    
    <!-- Add Action (Context Sensitive) -->
    <view class="header-action" wx:if="{{subTab==='ann'}}" bindtap="onToggleCreateForm">
      <text class="icon">+</text> æ–°å¢
    </view>
    <view class="header-action" wx:if="{{subTab==='bulletin'}}" bindtap="tbToggleCreateForm">
      <text class="icon">+</text> æ–°å¢
    </view>
  </view>

  <scroll-view scroll-y class="content-scroll">
    <!-- Announcements List -->
    <view class="list-container" wx:if="{{subTab==='ann'}}">
      <block wx:for="{{list}}" wx:key="_id">
        <view class="card">
          <view class="card-main">
            <view class="card-header">
              <text class="card-title">{{item.title}}</text>
              <view class="status-badge {{item.isActive ? 'active' : 'inactive'}}">
                {{item.isActive ? 'å·²å‘å¸ƒ' : 'è‰ç¨¿'}}
              </view>
            </view>
            <view class="card-meta">
              <text class="meta-tag type">{{item.type}}</text>
              <text class="meta-date">{{item.updateTimeText}}</text>
            </view>
          </view>
          
          <view class="card-actions">
             <view class="switch-wrapper">
               <text class="switch-label">é¦–é¡µå±•ç¤º</text>
               <switch checked="{{item.showOnHome}}" bindchange="onHomeSwitchChange" data-id="{{item._id}}" color="#1677ff" style="transform: scale(0.7)"/>
             </view>
             <view class="btn-group">
                <view class="icon-btn edit" bindtap="onEdit" data-id="{{item._id}}">âœ</view>
                <view class="icon-btn delete" bindtap="onDelete" data-id="{{item._id}}">ğŸ—‘</view>
             </view>
          </view>
        </view>
      </block>
      <view wx:if="{{list.length === 0}}" class="empty-tip">æš‚æ— å…¬å‘Š</view>
    </view>

    <!-- Bulletins List -->
    <view class="list-container" wx:if="{{subTab==='bulletin'}}">
      <block wx:for="{{bulletins}}" wx:key="_id">
        <view class="card">
           <view class="card-main">
            <view class="card-header">
              <text class="card-title">{{item.title}}</text>
            </view>
             <view class="card-meta">
              <text class="meta-date">æ—¥æœŸ: {{item.date}}</text>
              <text class="meta-location" wx:if="{{item.location}}">ğŸ“ {{item.location}}</text>
            </view>
          </view>
           <view class="card-actions">
             <view class="switch-wrapper">
               <text class="switch-label">é¦–é¡µå±•ç¤º</text>
               <switch checked="{{item.showOnHome}}" bindchange="onTbHomeSwitchChange" data-id="{{item._id}}" color="#1677ff" style="transform: scale(0.7)"/>
             </view>
             <view class="btn-group">
                <view class="icon-btn edit" bindtap="tbEdit" data-item="{{item}}">âœ</view>
                <view class="icon-btn delete" bindtap="tbDelete" data-id="{{item._id}}">ğŸ—‘</view>
             </view>
          </view>
        </view>
      </block>
      <view wx:if="{{bulletins.length === 0}}" class="empty-tip">æš‚æ— è®­ç»ƒé€šå‘Š</view>
    </view>
  </scroll-view>

  <!-- Create/Edit Modal for Announcement -->
  <view wx:if="{{showCreateForm || editModal.show}}" class="modal-mask" catchtouchmove="true">
    <view class="modal">
      <view class="modal-header">
        <text class="modal-title">{{editModal.show ? 'ç¼–è¾‘å…¬å‘Š' : 'æ–°å¢å…¬å‘Š'}}</text>
        <view class="modal-close" bindtap="{{editModal.show ? 'onEditModalCancel' : 'onToggleCreateForm'}}">Ã—</view>
      </view>
      <scroll-view scroll-y class="modal-body">
        <view class="form-group">
          <view class="form-item">
            <text class="label">æ ‡é¢˜</text>
            <input class="input" placeholder="è¯·è¾“å…¥æ ‡é¢˜" value="{{editModal.show ? editModal.title : title}}" bindinput="{{editModal.show ? 'onEditModalInputTitle' : 'onInputTitle'}}"/>
          </view>
          <view class="form-item">
            <text class="label">ç±»å‹</text>
            <picker range="{{types}}" value="{{editModal.show ? editModal.typeIndex : typeIndex}}" bindchange="{{editModal.show ? 'onEditModalTypeChange' : 'onTypeChange'}}">
              <view class="picker">{{types[editModal.show ? editModal.typeIndex : typeIndex]}}</view>
            </picker>
          </view>
          <view class="form-item">
            <text class="label">å†…å®¹</text>
            <textarea class="textarea" placeholder="è¯·è¾“å…¥å†…å®¹" value="{{editModal.show ? editModal.content : content}}" bindinput="{{editModal.show ? 'onEditModalInputContent' : 'onInputContent'}}"/>
          </view>
          <view class="form-item flex-row">
            <text class="label">çŠ¶æ€ (æ˜¯å¦ç«‹å³å‘å¸ƒ)</text>
            <switch checked="{{editModal.show ? editModal.isActive : isActive}}" bindchange="{{editModal.show ? 'onEditModalActiveChange' : 'onActiveChange'}}" color="#1677ff"/>
          </view>
        </view>
      </scroll-view>
      <view class="modal-footer">
        <button class="btn secondary" bindtap="{{editModal.show ? 'onEditModalCancel' : 'onToggleCreateForm'}}">å–æ¶ˆ</button>
        <button class="btn primary" bindtap="{{editModal.show ? 'onEditModalConfirm' : 'onCreate'}}">ç¡®è®¤</button>
      </view>
    </view>
  </view>

  <!-- Create/Edit Modal for Bulletin -->
  <view wx:if="{{tbShowCreateForm || tbForm.id}}" class="modal-mask" catchtouchmove="true">
    <view class="modal">
      <view class="modal-header">
        <text class="modal-title">{{tbForm.id ? 'ç¼–è¾‘é€šå‘Š' : 'æ–°å¢é€šå‘Š'}}</text>
        <view class="modal-close" bindtap="tbCancel">Ã—</view>
      </view>
      <scroll-view scroll-y class="modal-body">
         <view class="form-group">
          <view class="form-item">
            <text class="label">æ ‡é¢˜</text>
            <input class="input" placeholder="è¯·è¾“å…¥æ ‡é¢˜" value="{{tbForm.title}}" bindinput="tbInputTitle"/>
          </view>
          <view class="form-item">
            <text class="label">æ—¥æœŸ</text>
            <picker mode="date" value="{{tbForm.date}}" bindchange="tbDateChange">
               <view class="picker">{{tbForm.date || 'é€‰æ‹©æ—¥æœŸ'}}</view>
            </picker>
          </view>
          <view class="form-item">
            <text class="label">åœ°ç‚¹</text>
            <input class="input" placeholder="è¯·è¾“å…¥åœ°ç‚¹" value="{{tbForm.location}}" bindinput="tbInputLocation"/>
          </view>
          <view class="form-item">
            <text class="label">è¯¦ç»†å†…å®¹</text>
            <textarea class="textarea" placeholder="è¯·è¾“å…¥è¯¦ç»†å†…å®¹" value="{{tbForm.content}}" bindinput="tbInputContent"/>
          </view>
          <view class="form-item flex-row">
             <text class="label">é¦–é¡µå±•ç¤º</text>
             <switch checked="{{tbForm.showOnHome}}" bindchange="tbSwitchShowOnHome" color="#1677ff"/>
          </view>
         </view>
      </scroll-view>
      <view class="modal-footer">
        <button class="btn secondary" bindtap="tbCancel">å–æ¶ˆ</button>
        <button class="btn primary" bindtap="tbSave">ç¡®è®¤</button>
      </view>
    </view>
  </view>

</view>
