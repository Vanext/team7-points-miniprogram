<view class="container">
  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs-container">
    <view class="tabs">
      <view class="tab {{status==='pending'?'active':''}}" data-status="pending" bindtap="onTab">
        <text class="tab-text">å¾…å¤„ç†</text>
        <view class="tab-indicator" wx:if="{{status==='pending'}}"></view>
      </view>
      <view class="tab {{status==='shipped'?'active':''}}" data-status="shipped" bindtap="onTab">
        <text class="tab-text">å·²å‘è´§</text>
        <view class="tab-indicator" wx:if="{{status==='shipped'}}"></view>
      </view>
      <view class="tab {{status==='completed'?'active':''}}" data-status="completed" bindtap="onTab">
        <text class="tab-text">å·²å®Œæˆ</text>
        <view class="tab-indicator" wx:if="{{status==='completed'}}"></view>
      </view>
      <view class="tab {{status==='all'?'active':''}}" data-status="all" bindtap="onTab">
        <text class="tab-text">å…¨éƒ¨</text>
        <view class="tab-indicator" wx:if="{{status==='all'}}"></view>
      </view>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <scroll-view scroll-y class="records-scroll" enable-back-to-top>
    <view class="records-list">
      <block wx:if="{{list.length > 0}}">
        <view wx:for="{{list}}" wx:key="_id" class="record-card">
          <!-- ä¸»è¦å†…å®¹åŒºåŸŸï¼šå·¦ä¾§ä¿¡æ¯ + å³ä¾§å›¾ç‰‡(å¯é€‰) -->
          <view class="card-main">
            <!-- å·¦ä¾§ä¿¡æ¯åŒº -->
            <view class="card-info">
              <!-- é¡¶éƒ¨ï¼šå•†å“å -->
              <view class="info-header">
                <text class="name">{{item.productName}}</text>
                <text class="count-badge">x{{item.quantity}}</text>
              </view>

              <!-- ç”¨æˆ·ä¿¡æ¯ -->
              <view class="user-meta">
                <text class="user-name">ç”¨æˆ·ï¼š{{item.userNickName || item._openid}}</text>
                <text class="points-cost">-{{item.pointsSpent}}ç§¯åˆ†</text>
              </view>

              <!-- é…é€ä¿¡æ¯ -->
              <view class="info-desc">
                <view class="desc-row">
                  <text class="label">æ–¹å¼ï¼š</text>
                  <text class="value">{{item.recipient.method === 'mail' ? 'é‚®å¯„' : 'å½“é¢'}}</text>
                </view>
                <view class="desc-row" wx:if="{{item.selectedSize}}">
                  <text class="label">å°ºç ï¼š</text>
                  <text class="value">{{item.selectedSize}}</text>
                </view>
                <view class="desc-row" catchtap="onCopy" data-type="recipient" data-content="{{item.recipient.name}}ï¼ˆ{{item.recipient.phone}}ï¼‰">
                  <text class="label">æ”¶ä»¶ï¼š</text>
                  <text class="value copyable">{{item.recipient.name}} {{item.recipient.phone}}</text>
                </view>
                <view class="desc-row" wx:if="{{item.recipient.method==='mail'}}" catchtap="onCopy" data-type="address" data-content="{{item.recipient.address}}">
                  <text class="label">åœ°å€ï¼š</text>
                  <text class="value copyable address-text">{{item.recipient.address}}</text>
                </view>
                <view class="desc-row" wx:if="{{item.recipient.remark}}">
                  <text class="label">å¤‡æ³¨ï¼š</text>
                  <text class="value">{{item.recipient.remark}}</text>
                </view>
                <view class="desc-row logistics" wx:if="{{item.status==='shipped' && item.logistics && (item.logistics.company || item.logistics.trackingNumber)}}">
                  <text class="label">ç‰©æµï¼š</text>
                  <text class="value">{{item.logistics.company}} {{item.logistics.trackingNumber}}</text>
                </view>
              </view>
            </view>
            
            <!-- å³ä¾§å›¾ç‰‡å ä½ (å¦‚æœå•†å“æœ‰å›¾å¯ä»¥åœ¨æ­¤å±•ç¤ºï¼Œç›®å‰æš‚æ— å•†å“å›¾å­—æ®µï¼Œä¿ç•™ç»“æ„) -->
            <!-- <view class="card-media" wx:if="{{item.thumb}}">
              <image src="{{item.thumb}}" mode="aspectFill" class="media-img"></image>
            </view> -->
          </view>

          <!-- åº•éƒ¨æ“ä½œæ  -->
          <view class="card-actions">
            <!-- çŠ¶æ€æ ‡ç­¾ -->
            <view class="status-tag {{item.status}}">
              <block wx:if="{{item.status === 'pending'}}"><text class="icon">â³</text> å¾…å¤„ç†</block>
              <block wx:elif="{{item.status === 'shipped'}}"><text class="icon">ğŸšš</text> å·²å‘è´§</block>
              <block wx:elif="{{item.status === 'completed'}}"><text class="icon">âœ“</text> å·²å®Œæˆ</block>
              <block wx:elif="{{item.status === 'cancelled'}}"><text class="icon">âœ•</text> å·²å–æ¶ˆ</block>
              <block wx:else>{{item.displayStatus}}</block>
            </view>
            
            <view class="spacer"></view>

            <!-- æ“ä½œæŒ‰é’® -->
            <view class="btn-group">
              <block wx:if="{{status==='pending' && item.status==='pending'}}">
                <view class="action-btn secondary" catchtap="onCancel" data-id="{{item._id}}">å–æ¶ˆ</view>
                <view class="action-btn primary" catchtap="onShip" data-id="{{item._id}}">å‘è´§</view>
                <view class="action-btn success" catchtap="onConfirmDone" data-id="{{item._id}}">å½“é¢å®Œæˆ</view>
              </block>
              <block wx:if="{{status==='shipped' && item.status==='shipped'}}">
                <view class="action-btn success" catchtap="onConfirmDone" data-id="{{item._id}}">ç¡®è®¤å®Œæˆ</view>
              </block>
            </view>
          </view>
        </view>
      </block>

      <view class="empty-state" wx:elif="{{list.length===0}}">
        <text>æš‚æ— è®°å½•</text>
      </view>
    </view>
  </scroll-view>
</view>