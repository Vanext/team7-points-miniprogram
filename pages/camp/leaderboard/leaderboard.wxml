<!--pages/camp/leaderboard/leaderboard.wxml-->
<view class="camp-leaderboard">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">åŠ è½½æ’è¡Œæ¦œä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="loadLeaderboard">é‡æ–°åŠ è½½</button>
  </view>

  <!-- æ— æƒé™çŠ¶æ€ -->
  <view wx:elif="{{!hasAccess}}" class="access-denied">
    <image class="lock-icon" src="/images/lock.png" mode="aspectFit"></image>
    <text class="denied-title">è®­ç»ƒè¥åŠŸèƒ½ä»…é™æ­£å¼ä¼šå‘˜</text>
    <text class="denied-desc">è¯·è”ç³»æ•™ç»ƒå‡çº§ä¸ºæ­£å¼ä¼šå‘˜</text>
  </view>

  <!-- æ’è¡Œæ¦œå†…å®¹ -->
  <view wx:else class="main-content">
    <!-- Tabåˆ‡æ¢ -->
    <view class="tab-container">
      <view class="tab-item {{activeTab === 'camp' ? 'active' : ''}}" data-tab="camp" bindtap="switchTab">
        <text class="tab-text">è®­ç»ƒè¥æ’è¡Œ</text>
      </view>
      <view class="tab-item {{activeTab === 'training' ? 'active' : ''}}" data-tab="training" bindtap="switchTab">
        <text class="tab-text">è®­ç»ƒæ—¶é•¿æ’è¡Œ</text>
      </view>
    </view>

    <!-- è®­ç»ƒè¥æ’è¡Œæ¦œ -->
    <view wx:if="{{activeTab === 'camp'}}">
      <!-- è®­ç»ƒè¥ä¿¡æ¯ -->
      <view class="camp-info-section">
        <view class="camp-info-card">
          <text class="camp-name">{{campInfo.name}}</text>
          <text class="camp-participants">{{campInfo.total_weeks}}å‘¨è®­ç»ƒ Â· {{leaderboard.length}}äººå‚ä¸</text>
        </view>
      </view>

      <!-- å½“å‰ç”¨æˆ·æ’å -->
      <view wx:if="{{currentUserRank}}" class="current-user-section">
        <view class="current-user-card">
          <view class="user-rank-info">
            <text class="rank-badge {{getRankStyle(currentUserRank.rank)}}">{{formatRank(currentUserRank.rank)}}</text>
            <view class="user-info">
              <text class="user-name">æˆ‘çš„æ’å</text>
              <text class="user-stats">ç¬¬{{currentUserRank.rank}}å Â· å®Œæˆ{{currentUserRank.weeksCompleted}}å‘¨</text>
            </view>
          </view>
          <view class="completion-rate">
            <text class="rate-value">{{formatCompletionRate(currentUserRank.avgCompletionRate)}}</text>
            <text class="rate-label">å¹³å‡å®Œæˆç‡</text>
          </view>
        </view>
      </view>

      <!-- æ’è¡Œæ¦œåˆ—è¡¨ -->
      <view class="leaderboard-section">
        <view class="section-header">
          <text class="section-title">è®­ç»ƒæ’è¡Œæ¦œ</text>
          <text class="section-subtitle">æŒ‰å®Œæˆå‘¨æ•°å’Œå¹³å‡å®Œæˆç‡æ’åº</text>
        </view>

        <view class="leaderboard-list">
          <block wx:for="{{leaderboard}}" wx:key="userId">
            <view class="rank-item {{item.userId === currentUserRank.userId ? 'current-user' : ''}}">
              <view class="rank-left">
                <text class="rank-number {{getRankStyle(item.rank)}}" style="color: {{getRankColor(item.rank)}}">
                  {{formatRank(item.rank)}}
                </text>
                <image class="user-avatar" src="{{item.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
                <view class="user-details">
                  <text class="user-name">{{item.nickname}}</text>
                  <text class="user-weeks">{{getBadgeIcon(item.weeksCompleted, campInfo.total_weeks)}} å®Œæˆ{{item.weeksCompleted}}å‘¨</text>
                </view>
              </view>
              <view class="rank-right">
                <text class="completion-rate-value">{{formatCompletionRate(item.avgCompletionRate)}}</text>
                <text class="completion-rate-label">å¹³å‡å®Œæˆç‡</text>
              </view>
            </view>
          </block>
        </view>
      </view>

      <!-- æ’è¡Œæ¦œè¯´æ˜ -->
      <view class="leaderboard-info">
        <view class="info-card">
          <text class="info-title">æ’è¡Œæ¦œè§„åˆ™</text>
          <view class="info-item">
            <text class="info-icon">ğŸ“Š</text>
            <text class="info-text">æŒ‰å®Œæˆå‘¨æ•°æ’åºï¼Œå‘¨æ•°ç›¸åŒæŒ‰å¹³å‡å®Œæˆç‡æ’åº</text>
          </view>
          <view class="info-item">
            <text class="info-icon">âœ…</text>
            <text class="info-text">æ¯å‘¨ä¸Šä¼ è®­ç»ƒæ€»ç»“ï¼Œå®¡æ ¸é€šè¿‡åè®¡å…¥æ’è¡Œæ¦œ</text>
          </view>
          <view class="info-item">
            <text class="info-icon">â°</text>
            <text class="info-text">å»ºè®®åœ¨æ¯å‘¨æ—¥å‰å®Œæˆå½“å‘¨è®­ç»ƒæ€»ç»“ä¸Šä¼ </text>
          </view>
        </view>
      </view>
    </view>

    <!-- è®­ç»ƒæ—¶é•¿æ’è¡Œæ¦œ -->
    <view wx:if="{{activeTab === 'training'}}">
      <!-- å½“å‰ç”¨æˆ·è®­ç»ƒæ—¶é•¿æ’å -->
      <view wx:if="{{currentTrainingUserRank}}" class="current-user-section">
        <view class="current-user-card">
          <view class="user-rank-info">
            <text class="rank-badge {{getRankStyle(currentTrainingUserRank.rank)}}">{{formatRank(currentTrainingUserRank.rank)}}</text>
            <view class="user-info">
              <text class="user-name">æˆ‘çš„æ’å</text>
              <text class="user-stats">ç¬¬{{currentTrainingUserRank.rank}}å Â· {{currentTrainingUserRank.totalTrainingHours}}å°æ—¶</text>
            </view>
          </view>
          <view class="completion-rate">
            <text class="rate-value">{{currentTrainingUserRank.totalTrainingHours}}</text>
            <text class="rate-label">è®­ç»ƒæ—¶é•¿(h)</text>
          </view>
        </view>
      </view>

      <!-- è®­ç»ƒæ—¶é•¿æ’è¡Œæ¦œåˆ—è¡¨ -->
      <view class="leaderboard-section">
        <view class="section-header">
          <text class="section-title">è®­ç»ƒæ—¶é•¿æ’è¡Œæ¦œ</text>
          <text class="section-subtitle">ç´¯è®¡è®­ç»ƒæ—¶é•¿æ’è¡Œ</text>
        </view>

        <view class="leaderboard-list">
          <block wx:for="{{trainingLeaderboard}}" wx:key="userId">
            <view class="rank-item {{item.userId === currentTrainingUserRank.userId ? 'current-user' : ''}}">
              <view class="rank-left">
                <text class="rank-number {{getRankStyle(item.rank)}}" style="color: {{getRankColor(item.rank)}}">
                  {{formatRank(item.rank)}}
                </text>
                <image class="user-avatar" src="{{item.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
                <view class="user-details">
                  <text class="user-name">{{item.nickname}}</text>
                  <text class="user-weeks">{{getTrainingBadgeIcon(item.totalTrainingHours)}} {{item.totalTrainingHours}}å°æ—¶</text>
                </view>
              </view>
              <view class="rank-right">
                <text class="completion-rate-value">{{item.trainingCount}}</text>
                <text class="completion-rate-label">è®­ç»ƒæ¬¡æ•°</text>
              </view>
            </view>
          </block>
        </view>
      </view>

      <!-- è®­ç»ƒæ—¶é•¿æ’è¡Œæ¦œè¯´æ˜ -->
      <view class="leaderboard-info">
        <view class="info-card">
          <text class="info-title">æ’è¡Œæ¦œè§„åˆ™</text>
          <view class="info-item">
            <text class="info-icon">â±ï¸</text>
            <text class="info-text">æŒ‰ç´¯è®¡è®­ç»ƒæ—¶é•¿æ’åº</text>
          </view>
          <view class="info-item">
            <text class="info-icon">ğŸ“ˆ</text>
            <text class="info-text">æ¯æ¬¡è®­ç»ƒå®Œæˆåè‡ªåŠ¨è®¡å…¥æ’è¡Œæ¦œ</text>
          </view>
          <view class="info-item">
            <text class="info-icon">ğŸ†</text>
            <text class="info-text">è®­ç»ƒæ—¶é•¿è¶Šå¤šï¼Œæ’åè¶Šé å‰</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>