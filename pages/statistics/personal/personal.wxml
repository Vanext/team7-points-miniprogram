<!--ä¸ªäººç»Ÿè®¡é¡µé¢-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-wrapper" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <view wx:else>
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="user-card">
      <view class="user-info">
        <image class="avatar" src="{{user.avatarUrl}}" mode="aspectFill"></image>
        <view class="user-details">
          <text class="nickname">{{user.nickname}}</text>
          <view class="admin-badge" wx:if="{{user.isAdmin}}">ç®¡ç†å‘˜</view>
        </view>
      </view>
      <view class="points-display">
        <text class="points-number">{{user.totalPoints}}</text>
        <text class="points-label">æ€»ç§¯åˆ†</text>
      </view>
    </view>

    <!-- æ—¶é—´èŒƒå›´é€‰æ‹© -->
    <view class="time-range-selector">
      <view class="range-item {{timeRange === item.value ? 'active' : ''}}" 
            wx:for="{{timeRanges}}" wx:key="value"
            data-range="{{item.value}}" bindtap="onTimeRangeChange">
        <text class="range-text">{{item.label}}</text>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="stats-overview">
      <view class="stat-item" bindtap="goToPointDetail">
        <text class="stat-number">{{summary.earnedPoints}}</text>
        <text class="stat-label">è·å¾—ç§¯åˆ†</text>
        <text class="stat-icon">ğŸ“ˆ</text>
      </view>
      <view class="stat-item" bindtap="goToExchangeHistory">
        <text class="stat-number">{{summary.spentPoints}}</text>
        <text class="stat-label">æ¶ˆè´¹ç§¯åˆ†</text>
        <text class="stat-icon">ğŸ’°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{summary.activeDays}}</text>
        <text class="stat-label">æ´»è·ƒå¤©æ•°</text>
        <text class="stat-icon">ğŸ“…</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{summary.totalRecords}}</text>
        <text class="stat-label">ç§¯åˆ†è®°å½•</text>
        <text class="stat-icon">ğŸ“</text>
      </view>
    </view>

    <!-- ç§¯åˆ†è¶‹åŠ¿å›¾è¡¨ -->
    <view class="chart-section">
      <view class="section-header">
        <text class="section-title">ç§¯åˆ†è¶‹åŠ¿</text>
        <text class="section-subtitle">{{currentTimeRangeLabel}}ç§¯åˆ†å˜åŒ–</text>
      </view>
      <view class="chart-container">
        <canvas 
          class="chart-canvas" 
          canvas-id="trendChart"
          bindinit="{{trendChart.onInit}}"
          disable-scroll="true">
        </canvas>
      </view>
    </view>

    <!-- æ´»åŠ¨ç±»å‹åˆ†å¸ƒ -->
    <view class="chart-section" wx:if="{{Object.keys(activityTypes).length > 0}}">
      <view class="section-header">
        <text class="section-title">æ´»åŠ¨ç±»å‹åˆ†å¸ƒ</text>
        <text class="section-subtitle">å„ç±»æ´»åŠ¨ç§¯åˆ†å æ¯”</text>
      </view>
      <view class="chart-container">
        <canvas 
          class="chart-canvas" 
          canvas-id="activityChart"
          bindinit="{{activityChart.onInit}}"
          disable-scroll="true">
        </canvas>
      </view>
      
      <!-- æ´»åŠ¨ç±»å‹åˆ—è¡¨ -->
      <view class="activity-list">
        <view class="activity-item" wx:for="{{Object.entries(activityTypes)}}" wx:key="index">
          <view class="activity-info">
            <text class="activity-icon">{{getActivityIcon(item[0])}}</text>
            <text class="activity-name">{{item[0]}}</text>
          </view>
          <text class="activity-points">{{item[1]}}åˆ†</text>
        </view>
      </view>
    </view>

    <!-- å…‘æ¢ç»Ÿè®¡ -->
    <view class="exchange-section" wx:if="{{exchangeStats.total > 0}}">
      <view class="section-header">
        <text class="section-title">å…‘æ¢ç»Ÿè®¡</text>
        <text class="section-subtitle">{{currentTimeRangeLabel}}å…‘æ¢æƒ…å†µ</text>
      </view>
      
      <view class="exchange-stats">
        <view class="exchange-stat-item">
          <text class="stat-number">{{exchangeStats.total}}</text>
          <text class="stat-label">æ€»å…‘æ¢</text>
        </view>
        <view class="exchange-stat-item">
          <text class="stat-number">{{exchangeStats.completed}}</text>
          <text class="stat-label">å·²å®Œæˆ</text>
        </view>
        <view class="exchange-stat-item">
          <text class="stat-number">{{exchangeStats.pending}}</text>
          <text class="stat-label">å¾…å¤„ç†</text>
        </view>
        <view class="exchange-stat-item">
          <text class="stat-number">{{exchangeStats.totalPoints}}</text>
          <text class="stat-label">æ¶ˆè´¹ç§¯åˆ†</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && summary.totalRecords === 0}}">
      <view class="empty-icon">ğŸ“Š</view>
      <text class="empty-text">æš‚æ— ç»Ÿè®¡æ•°æ®</text>
      <text class="empty-subtitle">å¼€å§‹å‚ä¸æ´»åŠ¨è·å¾—ç§¯åˆ†å§ï¼</text>
    </view>
  </view>
</view>