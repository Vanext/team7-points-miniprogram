<!--ç®¡ç†å‘˜ç»Ÿè®¡é¡µé¢-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-wrapper" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <view wx:else>
    <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
    <view class="overview-section">
      <view class="overview-header">
        <text class="section-title">ä¿±ä¹éƒ¨æ¦‚è§ˆ</text>
        <text class="active-rate">æ´»è·ƒç‡: {{getActiveRate()}}%</text>
      </view>
      
      <view class="overview-grid">
        <view class="overview-item" bindtap="goToMemberManagement">
          <text class="overview-number">{{summary.totalUsers}}</text>
          <text class="overview-label">æ€»æˆå‘˜</text>
          <text class="overview-icon">ğŸ‘¥</text>
        </view>
        <view class="overview-item">
          <text class="overview-number">{{summary.activeUsers}}</text>
          <text class="overview-label">æ´»è·ƒæˆå‘˜</text>
          <text class="overview-icon">ğŸ”¥</text>
        </view>
        <view class="overview-item" bindtap="goToAudit">
          <text class="overview-number">{{summary.pendingRecords}}</text>
          <text class="overview-label">å¾…å®¡æ ¸</text>
          <text class="overview-icon">â³</text>
        </view>
        <view class="overview-item">
          <text class="overview-number">{{summary.totalProducts}}</text>
          <text class="overview-label">å•†å“æ•°é‡</text>
          <text class="overview-icon">ğŸ›ï¸</text>
        </view>
        <view class="overview-item wide">
          <text class="overview-number">{{formatNumber(summary.totalPointsIssued)}}</text>
          <text class="overview-label">æ€»å‘æ”¾ç§¯åˆ†</text>
          <text class="overview-icon">ğŸ“ˆ</text>
        </view>
        <view class="overview-item wide" bindtap="goToExchangeManagement">
          <text class="overview-number">{{formatNumber(summary.totalPointsSpent)}}</text>
          <text class="overview-label">æ€»æ¶ˆè´¹ç§¯åˆ†</text>
          <text class="overview-icon">ğŸ’°</text>
        </view>
        <view class="overview-item" bindtap="goToApparelManagement">
          <text class="overview-number">{{summary.totalUsers}}</text>
          <text class="overview-label">æœè£…å‘æ”¾</text>
          <text class="overview-icon">ğŸ‘•</text>
        </view>
      </view>
    </view>

    <!-- æ—¶é—´èŒƒå›´é€‰æ‹© -->
    <view class="time-range-selector">
      <view class="range-item {{timeRange === item.value ? 'active' : ''}}" 
            wx:for="{{timeRanges}}" wx:key="value"
            data-range="{{item.value}}" bindtap="onTimeRangeChange">
        <text class="range-text">{{item.label}}</text>
      </view>
    </view>

    <!-- ç§¯åˆ†è¶‹åŠ¿å›¾è¡¨ -->
    <view class="chart-section">
      <view class="section-header">
        <text class="section-title">ç§¯åˆ†è¶‹åŠ¿</text>
        <text class="section-subtitle">{{currentTimeRangeLabel}}ç§¯åˆ†å‘æ”¾ä¸æ¶ˆè´¹</text>
      </view>
      <view class="chart-container">
        <canvas 
          class="chart-canvas" 
          canvas-id="trendChart"
          bindinit="{{trendChart.onInit}}"
          disable-scroll="true">
        </canvas>
      </view>
    </view>

    <!-- æ´»åŠ¨ç±»å‹ç»Ÿè®¡ -->
    <view class="chart-section" wx:if="{{Object.keys(activityStats).length > 0}}">
      <view class="section-header">
        <text class="section-title">æ´»åŠ¨ç±»å‹ç»Ÿè®¡</text>
        <text class="section-subtitle">å„ç±»æ´»åŠ¨ç§¯åˆ†åˆ†å¸ƒ</text>
      </view>
      <view class="chart-container">
        <canvas 
          class="chart-canvas" 
          canvas-id="activityChart"
          bindinit="{{activityChart.onInit}}"
          disable-scroll="true">
        </canvas>
      </view>
      
      <!-- æ´»åŠ¨ç»Ÿè®¡åˆ—è¡¨ -->
      <view class="stats-list">
        <view class="stats-item" wx:for="{{Object.entries(activityStats)}}" wx:key="index">
          <view class="stats-info">
            <text class="stats-icon">{{getActivityIcon(item[0])}}</text>
            <view class="stats-details">
              <text class="stats-name">{{item[0]}}</text>
              <text class="stats-count">{{item[1].count}}æ¬¡æ´»åŠ¨</text>
            </view>
          </view>
          <text class="stats-points">{{formatNumber(item[1].points)}}åˆ†</text>
        </view>
      </view>
    </view>

    <!-- çƒ­é—¨å•†å“ç»Ÿè®¡ -->
    <view class="chart-section" wx:if="{{Object.keys(productStats).length > 0}}">
      <view class="section-header">
        <text class="section-title">çƒ­é—¨å•†å“</text>
        <text class="section-subtitle">å…‘æ¢æ¬¡æ•°æ’è¡Œ</text>
      </view>
      <view class="chart-container">
        <canvas 
          class="chart-canvas" 
          canvas-id="productChart"
          bindinit="{{productChart.onInit}}"
          disable-scroll="true">
        </canvas>
      </view>
    </view>

    <!-- æ´»è·ƒç”¨æˆ·æ’è¡Œ -->
    <view class="ranking-section" wx:if="{{topUsers.length > 0}}">
      <view class="section-header">
        <text class="section-title">æ´»è·ƒç”¨æˆ·æ’è¡Œ</text>
        <text class="section-subtitle">{{currentTimeRangeLabel}}ç§¯åˆ†è·å¾—æ’è¡Œ</text>
      </view>
      
      <view class="ranking-list">
        <view class="ranking-item" wx:for="{{topUsers}}" wx:key="userId">
          <view class="ranking-number">
            <text class="rank">{{index + 1}}</text>
          </view>
          <image class="user-avatar" src="{{item.avatarUrl}}" mode="aspectFill"></image>
          <view class="user-info">
            <text class="user-nickname">{{item.nickname}}</text>
            <text class="user-records">{{item.records}}æ¡è®°å½•</text>
          </view>
          <text class="user-points">{{formatNumber(item.points)}}åˆ†</text>
        </view>
      </view>
    </view>

    <!-- æˆå‘˜æ´»è·ƒåº¦ -->
    <view class="member-section" wx:if="{{memberStats.length > 0}}">
      <view class="section-header">
        <text class="section-title">æˆå‘˜æ´»è·ƒåº¦</text>
        <text class="section-subtitle">{{currentTimeRangeLabel}}æˆå‘˜æ´»åŠ¨æƒ…å†µ</text>
      </view>
      
      <view class="member-list">
        <view class="member-item" wx:for="{{memberStats.slice(0, 20)}}" wx:key="userId">
          <image class="member-avatar" src="{{item.avatarUrl}}" mode="aspectFill"></image>
          <view class="member-info">
            <view class="member-name-row">
              <text class="member-nickname">{{item.nickname}}</text>
              <view class="admin-badge" wx:if="{{item.isAdmin}}">ç®¡ç†å‘˜</view>
            </view>
            <text class="member-activity">
              {{item.records}}æ¬¡æ´»åŠ¨ Â· {{formatNumber(item.points)}}ç§¯åˆ†
            </text>
          </view>
          <text class="member-total">{{formatNumber(item.totalPoints)}}</text>
        </view>
      </view>
      
      <view class="show-more" wx:if="{{memberStats.length > 20}}" bindtap="goToMemberManagement">
        <text class="show-more-text">æŸ¥çœ‹å…¨éƒ¨æˆå‘˜</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && summary.totalUsers === 0}}">
      <view class="empty-icon">ğŸ“Š</view>
      <text class="empty-text">æš‚æ— ç»Ÿè®¡æ•°æ®</text>
      <text class="empty-subtitle">ç­‰å¾…æˆå‘˜åŠ å…¥ä¿±ä¹éƒ¨</text>
    </view>
  </view>
</view>
