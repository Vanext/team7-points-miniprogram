<view class="container">
  <!-- Sticky Header -->
  <view class="page-header">
    <view class="tabs">
      <view class="tab-item {{currentTab === 'month' ? 'active' : ''}}" bindtap="switchTab" data-tab="month">æœˆè®­ç»ƒæ’è¡Œ</view>
      <view class="tab-item {{currentTab === 'season' ? 'active' : ''}}" bindtap="switchTab" data-tab="season">æ€»ç§¯åˆ†æ’è¡Œ</view>
    </view>
    <view wx:if="{{currentTab === 'month'}}" class="filter-bar">
      <picker mode="date" fields="month" value="{{selectedMonth}}" bindchange="onMonthChange">
        <view class="date-picker">
          <text class="current-date">{{selectedMonth}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
      <text wx:if="{{fallbackUsed}}" class="filter-tip">æœ¬æœˆæ— æ•°æ®ï¼Œå·²å±•ç¤º {{fallbackTipMonth}}</text>
    </view>
  </view>

  <scroll-view scroll-y class="main-content" enable-flex>
    <!-- Top 3 Area -->
    <view class="top3-container" wx:if="{{top3.length > 0}}">
      <!-- Rank 2 -->
      <view class="top3-item rank-2" wx:if="{{top3[1]}}">
        <view class="avatar-wrapper">
          <image class="avatar" src="{{top3[1].avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="rank-badge">2</view>
        </view>
        <text class="name">{{top3[1].nickName}}</text>
        <text class="points">{{top3[1].points}}</text>
      </view>

      <!-- Rank 1 -->
      <view class="top3-item rank-1" wx:if="{{top3[0]}}">
        <view class="crown">ğŸ‘‘</view>
        <view class="avatar-wrapper">
          <image class="avatar" src="{{top3[0].avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="rank-badge">1</view>
        </view>
        <text class="name">{{top3[0].nickName}}</text>
        <text class="points">{{top3[0].points}}</text>
      </view>

      <!-- Rank 3 -->
      <view class="top3-item rank-3" wx:if="{{top3[2]}}">
        <view class="avatar-wrapper">
          <image class="avatar" src="{{top3[2].avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="rank-badge">3</view>
        </view>
        <text class="name">{{top3[2].nickName}}</text>
        <text class="points">{{top3[2].points}}</text>
      </view>
    </view>

    <!-- Rank List (4+) -->
    <view class="list-card" wx:if="{{rankList.length > 0}}">
      <view class="rank-item" wx:for="{{rankList}}" wx:key="id">
        <view class="rank-left">
          <text class="rank-num">{{item.rank}}</text>
          <image class="user-avatar" src="{{item.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <text class="user-name">{{item.nickName}}</text>
        </view>
        <text class="user-points">{{item.points}}</text>
      </view>
    </view>

    <view class="empty-tip" wx:if="{{top3.length === 0 && rankList.length === 0 && !loading}}">
      <image class="empty-icon" src="/images/empty.png" mode="aspectFit" wx:if="{{false}}"></image> <!-- Placeholder for empty icon -->
      <text>æš‚æ— æ’è¡Œæ•°æ®</text>
    </view>
    
    <!-- Spacer for bottom bar -->
    <view class="bottom-spacer"></view>
  </scroll-view>

  <!-- My Rank (Fixed Bottom) -->
  <view class="my-rank-bar" wx:if="{{myRank}}">
    <view class="rank-left">
      <text class="rank-num">{{myRank.rank}}</text>
      <image class="user-avatar" src="{{myRank.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
      <text class="user-name">æˆ‘</text>
    </view>
    <text class="user-points">{{myRank.points}}</text>
  </view>
</view>
