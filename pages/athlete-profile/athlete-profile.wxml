<!--pages/athlete-profile/athlete-profile.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-skeleton">
      <view class="skeleton-header">
        <view class="skeleton-avatar"></view>
        <view class="skeleton-info">
          <view class="skeleton-line"></view>
          <view class="skeleton-line short"></view>
        </view>
      </view>
      <view class="skeleton-stats">
        <view class="skeleton-stat" wx:for="{{[1,2,3]}}" wx:key="*this">
          <view class="skeleton-line"></view>
          <view class="skeleton-line short"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-container" wx:if="{{error && !loading}}">
    <view class="error-icon">âš ï¸</view>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="retryLoad">é‡è¯•</button>
  </view>

  <!-- ç”¨æˆ·æ¡£æ¡ˆå†…å®¹ -->
  <view wx:if="{{!loading && !error && userInfo}}">
    <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
    <view class="profile-header">
      <view class="header-bg">
        <image class="user-avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="user-name">{{userInfo.nickName}}</text>
          <text class="user-id">ID: {{userInfo.openid || userId}}</text>
        </view>
        <button class="follow-btn {{isFollowing ? 'following' : ''}}" bindtap="toggleFollow">
          <text class="follow-text">{{isFollowing ? 'å·²å…³æ³¨' : 'å…³æ³¨'}}</text>
        </button>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ•°æ® -->
    <view class="stats-section">
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-number">{{totalParticipations}}</text>
          <text class="stat-label">å‚èµ›æ¬¡æ•°</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{totalPoints}}</text>
          <text class="stat-label">æ€»ç§¯åˆ†</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{userInfo.pointsCount || 0}}</text>
          <text class="stat-label">è·å¾—ç§¯åˆ†æ¬¡æ•°</text>
        </view>
      </view>
    </view>

    <!-- å‚èµ›å†å² -->
    <view class="history-section">
      <view class="section-header">
        <text class="section-title">Taçš„é“ä¸‰åŠ¨æ€</text>
      </view>

      <!-- å¹´åº¦åˆ†ç»„æ˜¾ç¤º -->
      <view class="yearly-history" wx:if="{{participationHistory.length > 0}}">
        <block wx:for="{{participationHistory}}" wx:key="id" wx:for-item="record">
          <!-- å¹´ä»½åˆ†éš”ç¬¦ -->
          <view class="year-divider" wx:if="{{index === 0 || record.year !== participationHistory[index-1].year}}">
            <text class="year-text">{{record.year || currentYear}}</text>
          </view>

          <!-- æ¯”èµ›è®°å½• -->
          <view class="event-card">
            <view class="event-header">
              <view class="event-info">
                <text class="event-name">{{record.eventName || 'é“äººä¸‰é¡¹æ¯”èµ›'}}</text>
                <view class="event-meta">
                  <text class="event-date">{{record.date || 'æ—¥æœŸæœªçŸ¥'}}</text>
                  <view class="event-type {{getEventTypeClass(record.eventType)}}">
                    <text class="type-text">{{record.eventType || 'é“äººä¸‰é¡¹'}}</text>
                  </view>
                </view>
              </view>
              <view class="event-result">
                <text class="result-time">{{record.completionTime || '--:--:--'}}</text>
              </view>
            </view>

            <!-- è¯¦ç»†æˆç»© -->
            <view class="event-details" wx:if="{{record.segments}}">
              <view class="segment" wx:for="{{record.segments}}" wx:key="type" wx:for-item="segment">
                <view class="segment-icon">
                  <text class="icon" wx:if="{{segment.type === 'swim'}}">ğŸŠ</text>
                  <text class="icon" wx:if="{{segment.type === 'bike'}}">ğŸš´</text>
                  <text class="icon" wx:if="{{segment.type === 'run'}}">ğŸƒ</text>
                </view>
                <view class="segment-info">
                  <text class="segment-name">{{segment.name}}</text>
                  <text class="segment-time">{{segment.time}}</text>
                </view>
              </view>
            </view>

            <!-- ç§¯åˆ†ä¿¡æ¯ -->
            <view class="points-info" wx:if="{{record.points}}">
              <text class="points-earned">+{{record.points}}ç§¯åˆ†</text>
            </view>
          </view>
        </block>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-history" wx:if="{{participationHistory.length === 0}}">
        <view class="empty-icon">ğŸƒâ€â™‚ï¸</view>
        <text class="empty-text">æš‚æ— å‚èµ›è®°å½•</text>
        <text class="empty-desc">è¯¥ç”¨æˆ·è¿˜æ²¡æœ‰å‚åŠ è¿‡æ¯”èµ›</text>
      </view>
    </view>
  </view>
</view>